services:
  app:
    build: .
    ports:
      - "8080:80"
    volumes:
      - mcp-sessions:/app/storage/mcp-sessions
    environment:
      - CRONITOR_API_KEY=${CRONITOR_API_KEY}
    restart: unless-stopped

  dev:
    build:
      context: .
      target: build
    ports:
      - "8082:80"
    volumes:
      - .:/app
      - ./Caddyfile:/etc/frankenphp/Caddyfile:ro
    environment:
      - CRONITOR_API_KEY=${CRONITOR_API_KEY}
      - MCP_DEBUG=${MCP_DEBUG:-false}
    command: frankenphp run --config /etc/frankenphp/Caddyfile
    profiles:
      - dev

  composer:
    build:
      target: build
    volumes:
      - .:/app
    profiles:
      - composer

volumes:
  mcp-sessions: