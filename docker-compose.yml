services:
  prod:
    build:
      context: .
      args:
        VERSION: ${MCP_VERSION:-0.0.0}
    ports:
      - "8081:80"
    volumes:
      - mcp-sessions:/app/storage/mcp-sessions
    environment:
      - CRONITOR_API_KEY=${CRONITOR_API_KEY}
    restart: unless-stopped
    profiles:
      - prod

  dev:
    build:
      context: .
      target: build
    ports:
      - "8080:80"
    volumes:
      - .:/app
      - ./Caddyfile:/etc/frankenphp/Caddyfile:ro
    environment:
      - CRONITOR_API_KEY=${CRONITOR_API_KEY}
      - MCP_DEBUG=${MCP_DEBUG:-false}
      - MCP_VERSION=${MCP_VERSION:-0.0.0-dev}
    command: frankenphp run --config /etc/frankenphp/Caddyfile

  composer:
    build:
      target: build
    volumes:
      - .:/app
    profiles:
      - composer

volumes:
  mcp-sessions: